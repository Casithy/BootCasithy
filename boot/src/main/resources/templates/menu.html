<html xmlns:th="http://www.thymeleaf.org">
<div th:include="header:: header"></div>
<body style="padding:80px;">
	<div class="container">

		<div class="well">
			<div class="row">
				<div class="col-md-3">
					<div id="treeview" class=""></div>
				</div>
				<div class="col-md-9">
					<form class="form-horizontal">
						<input type="hidden" id="parentId" name="parentId" value="">
						<fieldset>
							<legend>菜单详情</legend>
							<div class="row">
								<div class="col-md-10"></div>
								<div class="col-md-2">
									<input  type="button" class="btn-sm btn-primary" value="添加子菜单" onclick="insert()"/>
								</div>
							</div>
							<div class="form-group">
								<label for="inputEmail" class="col-lg-2 control-label">菜单名称</label>
								<div class="col-lg-10">
									<input type="text" class="form-control" id="text">
								</div>
							</div>
							<div class="form-group">
								<label for="inputPassword" class="col-lg-2 control-label">菜单链接</label>
								<div class="col-lg-10">
									<input type="text" class="form-control" id="href">
								</div>
							</div>
							<div class="form-group">
								<label for="inputPassword" class="col-lg-2 control-label">排序编号</label>
								<div class="col-lg-10">
									<input type="text" class="form-control" id="sortNo">
								</div>
							</div>
							<div class="form-group">
								<div class="col-lg-10 col-lg-offset-2">
									<div class="row">
										<div class="col-md-3"></div>
										<div class="col-md-2">
											<input id="del" type="button" class="btn btn-default" value="删除" />
										</div>
										<div class="col-md-7">
											<input id="sav" type="button" class="btn btn-primary" value="保存" />
										</div>
									</div>
								</div>
							</div>
						</fieldset>
					</from>
				</div>
			</div>
		</div>
	</div>
</body>
<script>
		$(function() {
			var userId = "";
			/*获取UserId*/
			$.ajax({
	            type: "GET",
	            url: "/user/loginUserInfo",
	            dataType: "json",
	            async: false,
	            success: function(data){
	            	userId = data.id;
	            }
			});
			/*获取菜单列表树*/
			$.ajax({
	            type: "GET",
	            url: "/menu/loadMenuTree/" + userId,
	            dataType: "json",
	            success: function(data){
	            	var $tree = $('#treeview').treeview({
	    				data: data,
	    				showIcon: true,
	    				//showCheckbox: true,
	    				showTags: true,
	    				//onNodeChecked: function(event, node) {
	    					//layer.alert(node.id+"--"+node.url, {icon: 6});
	    				//},
	    				//onNodeUnchecked: function (event, node) {
	    					//$('#checkable-output').prepend('<p>' + node.text + ' was unchecked</p>');
	    				//},
	    				onNodeSelected: function(event, node) {
	    					showNode(node);
	    				}
	    			});
	    			var sel = $('#treeview').treeview('getSelected');
	    			showNode(sel[0]);
	            },
	            error: function(){
	            	layer.alert('加载菜单树失败，请联系管理员', {icon: 5});
	            }
	       });
		});
		function showNode(node){
			$("#text").val('');$("#text").val(node.text);
			$("#href").val('');$("#href").val(node.href);
			$("#sortNo").val('');$("#sortNo").val(node.tags);
		}
		function insert(){
			var sel = $('#treeview').treeview('getSelected');
			$("#parentId").val('');$("#parentId").val(sel.id);
			$("#text").val('');
			$("#href").val('');
			$("#sortNo").val('');
			$("#del").val('');$("#del").val('取消');
			$("#sav").val('');$("#sav").val('提交');
		}
	</script>
</html>